{% extends "admin_base.html" %}

{% block info %}
    <h3>课程信息表</h3>
    <div class="inf">
        <div>
            <a class="btn btn-primary" id="add_course">+ 添加</a>
        </div>
        <br>
        <div class="guodong">
            <table class="table table-hover">
                <tr class="table-primary">
                    <td>课&nbsp&nbsp程&nbsp&nbsp编&nbsp&nbsp号</td>
                    <td>课&nbsp&nbsp程&nbsp&nbsp名&nbsp&nbsp称</td>
                    <td>教&nbsp&nbsp师&nbsp&nbsp工&nbsp&nbsp号</td>
                    <td>教&nbsp&nbsp&nbsp师</td>
                    <td>学&nbsp&nbsp&nbsp分</td>
                    <td>培&nbsp&nbsp养&nbsp&nbsp方&nbsp&nbsp案</td>
                    <td>操&nbsp&nbsp&nbsp作</td>
                </tr>
                {% for info in all_info %}
                    <tr>
                        <td>{{ info.course.cid }}</td>
                        <td>{{ info.course.name }}</td>
                        <td>{{ info.course.tid }}</td>
                        <td>{{ info.tname }}</td>
                        <td>{{ info.course.credit }}</td>
                        <td>{{ info.course.cls_name }}</td>
                        <td>
                            <a class="btn btn-primary table_alter_info">修改</a>
                            <a class="btn btn-danger" href="del_course?sid={{ info.sid }}">删除</a>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock %}

{% block windnows %}
    <div id='shadow' class="shadow hide"></div>
    <div id='add_course_info' class="modal1 hide">
        <div style="padding: 0 10px;">
            <h3 style="margin-top: 10px;">添加课程信息</h3>
            <br>
            <form>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">课程编号</span>
                    </div>
                    <input id='add_cid' type="text" class="form-control" name="add_cid" placeholder="课程编号"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">课程名称</span>
                    </div>
                    <input id='add_cname' type="text" class="form-control" name="add_cname" placeholder="课程名称"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">教师工号</span>
                    </div>
                    <input id='add_tid' type="text" class="form-control" name="add_tid" placeholder="教师工号"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">教师</span>
                    </div>
                    <input id='add_tname' type="text" class="form-control" name="add_tname" placeholder="教师"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">学分</span>
                    </div>
                    <input id='add_credit' type="text" class="form-control" name="add_credit" placeholder="学分"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">培养方案</span>
                    </div>
                    <input id='add_cls_name' type="text" class="form-control" name="add_cls_name" placeholder="培养方案"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
            </form>
            <input id="btnAdd" class="bttn bttn-primary" type="button" value="添加"/>
            <input class="btnCancel bttn bttn-secondary" type="button" value="取消"/>
            <span id="errormsg" style="color: #ff0000"></span>
        </div>
    </div>

    <div id='shadow' class="shadow hide"></div>
    <div id='alter_course_info' class="modal1 hide">
        <div style="padding: 0 10px;">
            <h3 style="margin-top: 10px;">修改课程信息</h3>
            <br>
            <form>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">课程编号</span>
                    </div>
                    <input id='alter_cid' type="text" class="form-control" name="alter_cid" placeholder="课程编号"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">课程名称</span>
                    </div>
                    <input id='alter_cname' type="text" class="form-control" name="alter_cname" placeholder="课程名称"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">教师工号</span>
                    </div>
                    <input id='alter_tid' type="text" class="form-control" name="alter_tid" placeholder="教师工号"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">教师</span>
                    </div>
                    <input id='alter_tname' type="text" class="form-control" name="alter_tname" placeholder="教师"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">学分</span>
                    </div>
                    <input id='alter_credit' type="text" class="form-control" name="alter_credit" placeholder="教师"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
                <div class="input-group mb-3" style="padding: 0 20px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">培养方案</span>
                    </div>
                    <input id='alter_cls_name' type="text" class="form-control" name="alter_cls_name" placeholder="培养方案"
                           aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"/>
                </div>
            </form>
            <input id="btnAlter" class="bttn bttn-primary" type="button" value="修改"/>
            <input class="btnCancel bttn bttn-secondary" type="button" value="取消"/>
            <span id="errormsg" style="color: #ff0000"></span>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="/static/js/jquery-2.2.4.min.js"></script>
    <script>
        $(function () {
            click_add_course();
            add_course();
            click_alter();
            alter();
            cancel();
        })

        function click_add_course(){
            $("#add_course").click(function (){
                $("#shadow").removeClass("hide");
                $("#add_course_info").removeClass("hide");

                $('#add_cid').val('');
                $('#add_cname').val('');
                $('#add_tid').val('');
                $('#add_tname').val('');
                $('#add_credit').val('');
                $('#add_cls_name').val('');

            });
        }

        function add_course(){
            $("#btnAdd").click(function (){
                $.ajax({
                    url: '/system_admin/add_course',
                    type: 'post',
                    data: {'cid': $('#add_cid').val(), 'cname': $('#add_cname').val(),'tid': $('#add_tid').val(),
                    'tname': $('#add_tname').val(),'credit': $('#add_credit').val(),'cls_name': $('#add_cls_name').val(),},
                    dataType: 'JSON',
                    success: function (arg) {

                        if (arg.status) {
                            location.reload();
                        } else {
                            $('#errormsg').text(arg.message);
                        }
                    }
                });
            });
        }

        function click_alter() {
            $(".table_alter_info").click(function () {
                $("#shadow").removeClass("hide");
                $("#alter_course_info").removeClass("hide");

                var row = $(this).parent().prevAll();

                var cid = $.trim($(row[5]).text());
                var cname = $.trim($(row[4]).text());
                var tid = $.trim($(row[3]).text());
                var tname = $.trim($(row[2]).text());
                var credit = $.trim($(row[1]).text());
                var cls_name = $.trim($(row[0]).text());

                $('#alter_cid').val(cid);
                $('#alter_cname').val(cname);
                $('#alter_tid').val(tid);
                $('#alter_tname').val(tname);
                $('#alter_credit').val(credit);
                $('#alter_cls_name').val(cls_name);
            });
        }

        function alter() {
            $('#btnAlter').click(function () {
                $.ajax({
                    url: '/system_admin/alter_course',
                    type: 'post',
                    data: {'cid': $('#alter_cid').val(), 'cname': $('#alter_cname').val(),'tid': $('#alter_tid').val(),
                    'tname': $('#alter_tname').val(),'credit': $('#alter_credit').val(),'cls_name': $('#alter_cls_name').val(),},
                    dataType: 'JSON',
                    success: function (arg) {

                        if (arg.status) {
                            location.reload();
                        } else {
                            $('#errormsg').text(arg.message);
                        }
                    }
                });
            });
        }

        function cancel() {
            $('.btnCancel').click(function () {
                $('#shadow,#add_course_info').addClass('hide');
                $('#shadow,#alter_course_info').addClass('hide');
            });
        }

    </script>
{% endblock %}